<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½é™¢é†«å¸«åº§è«‡æœƒæˆæ•ˆè¿½è¹¤å„€è¡¨æ¿</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out, border-color 0.15s ease-in-out;
        }

        body {
            font-family: "Noto Sans TC", sans-serif;
            background-color: #f8f7f5;
            color: #2c3e50;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* é é¢å®¹å™¨ */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* è¿”å›æŒ‰éˆ• */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #9ba8b8;
            text-decoration: none;
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            color: #7f8c8d;
            transform: translateX(-4px);
        }

        /* é ­éƒ¨ */
        .header {
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 0.95rem;
            color: #7f8c8d;
        }

        /* æŒ‰éˆ•çµ„ */
        .button-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: "Noto Sans TC", sans-serif;
        }

        .btn-primary {
            background-color: #9ba8b8;
            color: white;
        }

        .btn-primary:hover {
            background-color: #8a96a6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(155, 168, 184, 0.3);
        }

        .btn-secondary {
            background-color: #e8e6e3;
            color: #2c3e50;
        }

        .btn-secondary:hover {
            background-color: #ddd9d3;
        }

        /* çµ±è¨ˆå¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: rgba(61, 61, 61, 0.08) 0px 2px 8px;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: rgba(61, 61, 61, 0.12) 0px 4px 12px;
            transform: translateY(-2px);
        }

        .stat-card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .stat-card.primary {
            background: linear-gradient(135deg, #a8b8a0 0%, #9ba8b8 100%);
            color: white;
        }

        .stat-label {
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-detail {
            font-size: 0.85rem;
            opacity: 0.85;
        }

        /* åœ–è¡¨å€åŸŸ */
        .chart-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1.5rem;
        }

        .chart-container {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: rgba(61, 61, 61, 0.08) 0px 2px 8px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            margin-bottom: 1rem;
        }

        /* è¿½è¹¤é …ç›® */
        .tracking-items {
            margin-top: 2rem;
        }

        .tracking-item {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: rgba(61, 61, 61, 0.08) 0px 2px 8px;
            border-left: 4px solid #9ba8b8;
            transition: all 0.3s ease;
        }

        .tracking-item:hover {
            box-shadow: rgba(61, 61, 61, 0.12) 0px 4px 12px;
            transform: translateX(4px);
        }

        .tracking-item.pending {
            border-left-color: #b8a898;
        }

        .tracking-item.in-progress {
            border-left-color: #9ba8b8;
        }

        .tracking-item.completed {
            border-left-color: #a8b8a0;
        }

        .tracking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-pending {
            background-color: rgba(184, 168, 152, 0.15);
            color: rgb(184, 168, 152);
        }

        .status-in-progress {
            background-color: rgba(155, 168, 184, 0.15);
            color: rgb(155, 168, 184);
        }

        .status-completed {
            background-color: rgba(168, 184, 160, 0.15);
            color: rgb(168, 184, 160);
        }

        .category-badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 0.3rem;
            font-size: 0.8rem;
            font-weight: 500;
            background-color: #e8e6e3;
            color: #2c3e50;
            margin-right: 0.5rem;
        }

        .tracking-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .tracking-proposer {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
        }

        .tracking-progress {
            font-size: 0.9rem;
            color: #2c3e50;
            margin-top: 0.5rem;
            line-height: 1.5;
        }

        /* è©³ç´°åˆ†æé é¢ç‰¹å®šæ¨£å¼ */
        .meeting-info {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: rgba(61, 61, 61, 0.08) 0px 2px 8px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 1.5rem;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .info-icon {
            font-size: 1.5rem;
            color: #9ba8b8;
        }

        .info-content h3 {
            font-size: 0.85rem;
            color: #7f8c8d;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .info-content p {
            font-size: 1.1rem;
            color: #2c3e50;
            font-weight: 600;
        }

        .department-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .dept-tag {
            background-color: #a8b8a0;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .officials-section {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: rgba(61, 61, 61, 0.08) 0px 2px 8px;
        }

        .officials-section h2 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
        }

        .official-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e8e6e3;
        }

        .official-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .official-title {
            font-size: 0.9rem;
            color: #7f8c8d;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .official-name {
            font-size: 1rem;
            color: #2c3e50;
            font-weight: 600;
        }

        .category-section {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: rgba(61, 61, 61, 0.08) 0px 2px 8px;
        }

        .category-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #9ba8b8;
        }

        /* åŠ è¼‰ç‹€æ…‹ */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #7f8c8d;
        }

        .spinner {
            border: 4px solid #e8e6e3;
            border-top: 4px solid #9ba8b8;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 2rem;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }
        }

        /* é è…³ */
        .footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #e8e6e3;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .refresh-btn {
            background-color: #a8b8a0;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background-color: #97a68f;
        }

        .last-update {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¦–é  -->
        <div id="home-page" class="page active">
            <!-- é ­éƒ¨ -->
            <div class="header">
                <h1>ä½é™¢é†«å¸«åº§è«‡æœƒæˆæ•ˆè¿½è¹¤å„€è¡¨æ¿</h1>
                <p id="meeting-date">12/24/2025 åº§è«‡æœƒ</p>
            </div>

            <!-- æŒ‰éˆ•çµ„ -->
            <div class="button-group">
                <button class="btn btn-primary" onclick="goToAnalysis()">1141224åº§è«‡æœƒ</button>
                <button class="btn btn-secondary refresh-btn" onclick="loadData()">é‡æ–°æ•´ç†</button>
            </div>

            <!-- çµ±è¨ˆå¡ç‰‡ -->
            <div class="stats-grid" id="stats-container">
                <div class="card stat-card primary">
                    <div class="stat-label">æ•´é«”é”æˆç‡</div>
                    <div class="stat-value" id="completion-rate">11%</div>
                    <div class="stat-detail" id="completion-detail">1/9</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-label">å¾…æ±ºè­°</div>
                    <div class="stat-value" id="pending-count">2</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-label">é€²è¡Œä¸­</div>
                    <div class="stat-value" id="in-progress-count">6</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-label">å·²çµæ¡ˆ</div>
                    <div class="stat-value" id="completed-count">1</div>
                </div>
            </div>

            <!-- åœ–è¡¨å€åŸŸ -->
            <div class="chart-section">
                <h2 class="section-title">è­°é¡Œé¡åˆ¥çµ±è¨ˆ</h2>
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- è¿½è¹¤é …ç›® -->
            <div class="tracking-items">
                <h2 class="section-title">è¿½è¹¤é …ç›®</h2>
                <div id="tracking-list" class="loading">
                    <div class="spinner"></div>
                    <p>è¼‰å…¥ä¸­...</p>
                </div>
            </div>

            <!-- é è…³ -->
            <div class="footer">
                <p>Made with â¤ï¸ for Resident Meeting Tracking</p>
                <div class="last-update">
                    æœ€å¾Œæ›´æ–°ï¼š<span id="last-update-time">-</span>
                </div>
            </div>
        </div>

        <!-- è©³ç´°åˆ†æé é¢ -->
        <div id="analysis-page" class="page">
            <!-- è¿”å›æŒ‰éˆ• -->
            <a class="back-button" onclick="goToHome()">
                <span>â†</span>
                <span>è¿”å›é¦–é </span>
            </a>

            <!-- é ­éƒ¨ -->
            <div class="header">
                <h1>2025/12/24 åº§è«‡æœƒæˆæ•ˆåˆ†æ</h1>
            </div>

            <!-- åº§è«‡æœƒä¿¡æ¯ -->
            <div class="meeting-info">
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-icon">ğŸ“…</div>
                        <div class="info-content">
                            <h3>æ—¥æœŸ</h3>
                            <p>2025/12/24</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-icon">ğŸ“</div>
                        <div class="info-content">
                            <h3>åœ°é»</h3>
                            <p>554æœƒè­°å®¤</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-icon">ğŸ‘¥</div>
                        <div class="info-content">
                            <h3>ä½é™¢é†«å¸«å‡ºå¸­</h3>
                            <p>15 äºº</p>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 style="font-size: 0.9rem; color: #7f8c8d; font-weight: 500; margin-bottom: 0.75rem;">åƒèˆ‡ç§‘éƒ¨</h3>
                    <div class="department-tags">
                        <span class="dept-tag">å…’ç§‘éƒ¨</span>
                        <span class="dept-tag">æ”¾å°„è¨ºæ–·ç§‘</span>
                        <span class="dept-tag">å¾©å¥éƒ¨</span>
                        <span class="dept-tag">è§£å‰–ç—…ç†ç§‘</span>
                    </div>
                </div>
            </div>

            <!-- å‡ºå¸­é•·å®˜èˆ‡ä¸»ç®¡ -->
            <div class="officials-section">
                <h2>å‡ºå¸­é•·å®˜èˆ‡ä¸»ç®¡</h2>
                <div class="official-item">
                    <div class="official-title">ä¸»å¸­ï¼š</div>
                    <div class="official-name">é™³å¿—å‰æ¬¡å°ˆç§‘ä¸»ä»»</div>
                </div>
                <div class="official-item">
                    <div class="official-title">æŒ‡å°é•·å®˜ï¼š</div>
                    <div class="official-name">æ¹¯å®ä»å‰¯é™¢é•·ã€é™³å¿—æˆæ•™å­¸å‰¯é™¢é•·ã€å»–å®¶å¾·éƒ¨é•·</div>
                </div>
                <div class="official-item">
                    <div class="official-title">æ•™å­¸ä¸»ç®¡ï¼š</div>
                    <div class="official-name">åŠ‰é›¯å‰¯éƒ¨é•·</div>
                </div>
                <div class="official-item">
                    <div class="official-title">åˆ—å¸­ä¸»ç®¡ï¼š</div>
                    <div class="official-name">æœæ¼¢ç¥¥éƒ¨é•·ã€å³æƒ ç¾çµ„é•·ã€æ­é™½è‰¯å…¨çµ„é•·ã€é™³ä½³è“‰çµ„é•·ã€é™³æ†¶ç²çµ„é•·</div>
                </div>
                <div class="official-item">
                    <div class="official-title">æ•™å­¸è² è²¬äººï¼š</div>
                    <div class="official-name">é»ƒç­±å€«å‚™ä»»ä¸»æ²»é†«å¸«ã€æŸ¯æ™¯ä¸­ä¸»æ²»é†«å¸«ã€æœ±å½°å ¯ä¸»æ²»é†«å¸«</div>
                </div>
            </div>

            <!-- çµ±è¨ˆå¡ç‰‡ -->
            <div class="stats-grid">
                <div class="card stat-card">
                    <div class="stat-label">ä»¶ç¸½ææ¡ˆ</div>
                    <div class="stat-value" id="analysis-total">9</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-label">ä»¶é€²è¡Œä¸­</div>
                    <div class="stat-value" id="analysis-in-progress">6</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-label">ä»¶å·²çµæ¡ˆ</div>
                    <div class="stat-value" id="analysis-completed">1</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-label">æ•´é«”é”æˆç‡</div>
                    <div class="stat-value" id="analysis-rate">11%</div>
                </div>
            </div>

            <!-- è­°é¡Œé¡åˆ¥çµ±è¨ˆ -->
            <div class="chart-section">
                <h2 class="section-title">è­°é¡Œé¡åˆ¥çµ±è¨ˆ</h2>
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <canvas id="analysisChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- è­°é¡Œè¿½è¹¤ç¾æ³ -->
            <div class="tracking-items">
                <h2 class="section-title">è­°é¡Œè¿½è¹¤ç¾æ³</h2>
                <div id="analysis-tracking-list" class="loading">
                    <div class="spinner"></div>
                    <p>è¼‰å…¥ä¸­...</p>
                </div>
            </div>

            <!-- é è…³ -->
            <div class="footer">
                <p>Made with â¤ï¸ for Resident Meeting Tracking</p>
                <div class="last-update">
                    æœ€å¾Œæ›´æ–°ï¼š<span id="analysis-update-time">-</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é…ç½®
        const CONFIG = {
            API_URL: 'https://script.google.com/macros/s/AKfycbwp8wbNQaU0J9SQX6r1EUdhuAvnfDgsyfSXkIjtOHtGeXgu8hSN5_jKQ9_WqpFbvhkR9g/exec',
            REFRESH_INTERVAL: 5 * 60 * 1000
        };

        // è«è˜­è¿ªè‰²ç³»
        const COLORS = {
            pending: '#b8a898',
            inProgress: '#9ba8b8',
            completed: '#a8b8a0',
            categories: ['#9ba8b8', '#b8a898', '#a8b8a0', '#9b9fa8', '#a8a8a8']
        };

        let chartInstance = null;
        let analysisChartInstance = null;
        let allData = null;

        // é é¢åˆ‡æ›
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
        }

        function goToHome() {
            showPage('home-page');
        }

        function goToAnalysis() {
            showPage('analysis-page');
            updateAnalysisPage();
        }

        // è¼‰å…¥è³‡æ–™
        async function loadData() {
            try {
                console.log('æ­£åœ¨å¾ Google Sheets è¼‰å…¥è³‡æ–™...');
                const response = await fetch(CONFIG.API_URL);
                const data = await response.json();
                
                allData = data;
                console.log('è³‡æ–™å·²è¼‰å…¥:', data);

                // æ›´æ–°é¦–é 
                updateStats(data);
                updateChart(data);
                updateTrackingList(data);
                updateTimestamp();

                // æ›´æ–°åˆ†æé é¢
                updateAnalysisStats(data);
                updateAnalysisChart(data);
                updateAnalysisTrackingList(data);
                updateAnalysisTimestamp();
            } catch (error) {
                console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', error);
                document.getElementById('tracking-list').innerHTML = 
                    '<p style="color: #e74c3c;">è¼‰å…¥è³‡æ–™å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥æˆ–ç¨å¾Œé‡è©¦ã€‚</p>';
            }
        }

        // é¦–é  - æ›´æ–°çµ±è¨ˆå¡ç‰‡
        function updateStats(data) {
            if (!data.tracking || data.tracking.length === 0) return;

            const tracking = data.tracking;
            const pending = tracking.filter(item => item.status === 'å¾…æ±ºè­°').length;
            const inProgress = tracking.filter(item => item.status === 'é€²è¡Œä¸­').length;
            const completed = tracking.filter(item => item.status === 'å·²çµæ¡ˆ').length;
            const total = tracking.length;
            const completionRate = Math.round((completed / total) * 100);

            document.getElementById('completion-rate').textContent = completionRate + '%';
            document.getElementById('completion-detail').textContent = `${completed}/${total}`;
            document.getElementById('pending-count').textContent = pending;
            document.getElementById('in-progress-count').textContent = inProgress;
            document.getElementById('completed-count').textContent = completed;
        }

        // é¦–é  - æ›´æ–°åœ–è¡¨
        function updateChart(data) {
            if (!data.tracking || data.tracking.length === 0) return;

            const tracking = data.tracking;
            const categories = {};

            tracking.forEach(item => {
                const category = item.category || 'å…¶ä»–';
                categories[category] = (categories[category] || 0) + 1;
            });

            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        label: 'ææ¡ˆæ•¸',
                        data: Object.values(categories),
                        backgroundColor: COLORS.categories,
                        borderRadius: 4,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 2
                            }
                        }
                    }
                }
            });
        }

        // é¦–é  - æ›´æ–°è¿½è¹¤åˆ—è¡¨
        function updateTrackingList(data) {
            if (!data.tracking || data.tracking.length === 0) {
                document.getElementById('tracking-list').innerHTML = '<p>æš«ç„¡è¿½è¹¤é …ç›®</p>';
                return;
            }

            const tracking = data.tracking;
            let html = '';

            tracking.forEach(item => {
                const statusClass = item.status === 'å¾…æ±ºè­°' ? 'pending' : 
                                   item.status === 'é€²è¡Œä¸­' ? 'in-progress' : 'completed';
                const statusBadgeClass = item.status === 'å¾…æ±ºè­°' ? 'status-pending' : 
                                        item.status === 'é€²è¡Œä¸­' ? 'status-in-progress' : 'status-completed';

                html += `
                    <div class="tracking-item ${statusClass}">
                        <div class="tracking-header">
                            <div>
                                <span class="status-badge ${statusBadgeClass}">${item.status}</span>
                                <span class="category-badge">${item.category}</span>
                            </div>
                        </div>
                        <div class="tracking-title">${item.target}</div>
                        <div class="tracking-proposer">ææ¡ˆè€…ï¼š${item.proposer}</div>
                        ${item.tracking_report ? `<div class="tracking-progress"><strong>è¿½è¹¤é€²åº¦ï¼š</strong>${item.tracking_report}</div>` : ''}
                        ${item.tracking_date ? `<div class="tracking-progress"><strong>è¿½è¹¤æ—¥æœŸï¼š</strong>${item.tracking_date}</div>` : ''}
                    </div>
                `;
            });

            document.getElementById('tracking-list').innerHTML = html;
        }

        // åˆ†æé é¢ - æ›´æ–°çµ±è¨ˆå¡ç‰‡
        function updateAnalysisStats(data) {
            if (!data.tracking || data.tracking.length === 0) return;

            const tracking = data.tracking;
            const pending = tracking.filter(item => item.status === 'å¾…æ±ºè­°').length;
            const inProgress = tracking.filter(item => item.status === 'é€²è¡Œä¸­').length;
            const completed = tracking.filter(item => item.status === 'å·²çµæ¡ˆ').length;
            const total = tracking.length;
            const completionRate = Math.round((completed / total) * 100);

            document.getElementById('analysis-total').textContent = total;
            document.getElementById('analysis-in-progress').textContent = inProgress;
            document.getElementById('analysis-completed').textContent = completed;
            document.getElementById('analysis-rate').textContent = completionRate + '%';
        }

        // åˆ†æé é¢ - æ›´æ–°åœ–è¡¨
        function updateAnalysisChart(data) {
            if (!data.tracking || data.tracking.length === 0) return;

            const tracking = data.tracking;
            const categories = {};

            tracking.forEach(item => {
                const category = item.category || 'å…¶ä»–';
                categories[category] = (categories[category] || 0) + 1;
            });

            const ctx = document.getElementById('analysisChart').getContext('2d');
            
            if (analysisChartInstance) {
                analysisChartInstance.destroy();
            }

            analysisChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        label: 'ææ¡ˆæ•¸',
                        data: Object.values(categories),
                        backgroundColor: COLORS.categories,
                        borderRadius: 4,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 2
                            }
                        }
                    }
                }
            });
        }

        // åˆ†æé é¢ - æ›´æ–°è¿½è¹¤åˆ—è¡¨
        function updateAnalysisTrackingList(data) {
            if (!data.tracking || data.tracking.length === 0) {
                document.getElementById('analysis-tracking-list').innerHTML = '<p>æš«ç„¡è¿½è¹¤é …ç›®</p>';
                return;
            }

            const tracking = data.tracking;
            const categories = {};

            // æŒ‰é¡åˆ¥åˆ†çµ„
            tracking.forEach(item => {
                const category = item.category || 'å…¶ä»–';
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(item);
            });

            let html = '';

            Object.keys(categories).forEach(category => {
                const items = categories[category];
                html += `<div class="category-section">
                    <div class="category-title">${category} (${items.length} é …)</div>`;

                items.forEach((item, index) => {
                    const statusClass = item.status === 'å¾…æ±ºè­°' ? 'pending' : 
                                       item.status === 'é€²è¡Œä¸­' ? 'in-progress' : 'completed';
                    const statusBadgeClass = item.status === 'å¾…æ±ºè­°' ? 'status-pending' : 
                                            item.status === 'é€²è¡Œä¸­' ? 'status-in-progress' : 'status-completed';

                    html += `
                        <div class="tracking-item ${statusClass}">
                            <div class="tracking-header">
                                <div>
                                    <span class="status-badge ${statusBadgeClass}">${item.status}</span>
                                    <span>åºè™Ÿ ${index + 1}</span>
                                </div>
                            </div>
                            <div class="tracking-title">${item.target}</div>
                            <div class="tracking-proposer">ææ¡ˆè€…ï¼š${item.proposer}</div>
                            ${item.pic ? `<div class="tracking-proposer">è² è²¬çª—å£ï¼š${item.pic}</div>` : ''}
                            ${item.milestone ? `<div class="tracking-proposer">é è¨ˆé‡Œç¨‹ç¢‘ï¼š${item.milestone}</div>` : ''}
                            ${item.tracking_report ? `<div class="tracking-progress"><strong>è¿½è¹¤é€²åº¦ï¼š</strong>${item.tracking_report}</div>` : ''}
                            ${item.resolution ? `<div class="tracking-progress"><strong>æœƒè­°æ±ºè­°ï¼š</strong>${item.resolution}</div>` : ''}
                            ${item.tracking_date ? `<div class="tracking-progress"><strong>è¿½è¹¤æ—¥æœŸï¼š</strong>${item.tracking_date}</div>` : ''}
                            ${item.closure_date ? `<div class="tracking-progress"><strong>çµæ¡ˆæ—¥æœŸï¼š</strong>${item.closure_date}</div>` : ''}
                        </div>
                    `;
                });

                html += '</div>';
            });

            document.getElementById('analysis-tracking-list').innerHTML = html;
        }

        // æ›´æ–°æ™‚é–“æˆ³
        function updateTimestamp() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-TW');
            document.getElementById('last-update-time').textContent = timeString;
        }

        function updateAnalysisTimestamp() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-TW');
            document.getElementById('analysis-update-time').textContent = timeString;
        }

        // æ›´æ–°åˆ†æé é¢
        function updateAnalysisPage() {
            if (allData) {
                updateAnalysisStats(allData);
                updateAnalysisChart(allData);
                updateAnalysisTrackingList(allData);
                updateAnalysisTimestamp();
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setInterval(loadData, CONFIG.REFRESH_INTERVAL);
        });
    </script>
</body>
</html>
