<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½é™¢é†«å¸«åº§è«‡æœƒæˆæ•ˆè¿½è¹¤ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        /* å°èˆªæ¬„ */
        .navbar {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .navbar-logo {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .navbar-logo span {
            color: #4a90e2;
        }

        .navbar-nav {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: 2px solid transparent;
            background: transparent;
            color: #7f8c8d;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .nav-btn.active {
            background: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* é é¢å…§å®¹ */
        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== é¦–é æ¨£å¼ ===== */
        
        .header {
            background: white;
            padding: 40px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border-left: 5px solid #4a90e2;
        }

        .header h1 {
            font-size: 32px;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .meeting-info {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-label {
            color: #7f8c8d;
            font-size: 14px;
        }

        .info-value {
            color: #2c3e50;
            font-size: 16px;
            font-weight: 600;
        }

        /* çµ±è¨ˆå¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #4a90e2;
            margin-bottom: 10px;
        }

        .stat-unit {
            color: #95a5a6;
            font-size: 12px;
        }

        /* åœ–è¡¨å€ */
        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* è¿½è¹¤é …ç›®åˆ—è¡¨ */
        .tracking-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4a90e2;
        }

        .tracking-item {
            padding: 20px;
            border-left: 4px solid #4a90e2;
            background: #f8f9fa;
            margin-bottom: 20px;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .tracking-item:hover {
            background: #ecf0f1;
            border-left-color: #3498db;
        }

        .tracking-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tracking-sequence {
            display: inline-block;
            background: #4a90e2;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .tracking-category {
            display: inline-block;
            background: #e8f4f8;
            color: #2c3e50;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .tracking-status {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .status-pending {
            background: #f39c12;
        }

        .status-progress {
            background: #3498db;
        }

        .status-closed {
            background: #27ae60;
        }

        .tracking-target {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .tracking-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
            font-size: 14px;
        }

        .detail-item {
            padding: 10px;
            background: white;
            border-radius: 4px;
        }

        .detail-label {
            color: #7f8c8d;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .detail-value {
            color: #2c3e50;
            font-weight: 500;
            word-break: break-word;
        }

        /* å‡ºå¸­äººå“¡åˆ—è¡¨ */
        .attendance-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .attendance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .attendance-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4a90e2;
            transition: all 0.3s ease;
        }

        .attendance-card:hover {
            background: #ecf0f1;
            transform: translateY(-3px);
        }

        .attendance-name {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .attendance-info {
            font-size: 13px;
            color: #7f8c8d;
            line-height: 1.6;
        }

        .attendance-role {
            display: inline-block;
            background: #e8f4f8;
            color: #2c3e50;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 8px;
        }

        /* ===== è©³ç´°åˆ†æé é¢æ¨£å¼ ===== */

        .analysis-header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border-left: 5px solid #27ae60;
        }

        .analysis-header h2 {
            font-size: 28px;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .analysis-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .analysis-stat {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .analysis-stat-label {
            color: #7f8c8d;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .analysis-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #27ae60;
        }

        .analysis-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .analysis-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .analysis-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .category-item:last-child {
            border-bottom: none;
        }

        .category-name {
            color: #2c3e50;
            font-weight: 500;
        }

        .category-count {
            background: #4a90e2;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a90e2, #3498db);
            transition: width 0.3s ease;
        }

        /* æ›´æ–°æ™‚é–“æˆ³ */
        .update-timestamp {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #ecf0f1;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #7f8c8d;
        }

        .refresh-btn {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .refresh-btn:hover {
            background: #3498db;
        }

        .refresh-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        /* åŠ è¼‰ç‹€æ…‹ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .spinner {
            border: 4px solid #ecf0f1;
            border-top: 4px solid #4a90e2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fadbd8;
            color: #c0392b;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #c0392b;
            margin-bottom: 20px;
        }

        /* åº•éƒ¨ */
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 12px;
            margin-top: 40px;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .navbar-container {
                flex-direction: column;
                height: auto;
                padding: 15px 20px;
                gap: 15px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 24px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .charts-section {
                grid-template-columns: 1fr;
            }

            .tracking-details {
                grid-template-columns: 1fr;
            }

            .attendance-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .meeting-info {
                flex-direction: column;
                gap: 15px;
            }

            .analysis-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
            }

            .container {
                padding: 15px 10px;
            }

            .header {
                padding: 15px 10px;
            }

            .header h1 {
                font-size: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 28px;
            }

            .navbar-nav {
                width: 100%;
                flex-direction: column;
            }

            .nav-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- å°èˆªæ¬„ -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-logo">
                <span>ğŸ“Š</span>
                <span>ä½é™¢é†«å¸«åº§è«‡æœƒæˆæ•ˆè¿½è¹¤ç³»çµ±</span>
            </div>
            <div class="navbar-nav">
                <button class="nav-btn active" onclick="switchPage('home')">é¦–é å„€è¡¨æ¿</button>
                <button class="nav-btn" onclick="switchPage('analysis')">2025/12/24 æˆæ•ˆåˆ†æ</button>
            </div>
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- æ›´æ–°æ™‚é–“æˆ³ -->
        <div class="update-timestamp">
            <span>æœ€å¾Œæ›´æ–°æ™‚é–“ï¼š<strong id="lastUpdate">è¼‰å…¥ä¸­...</strong></span>
            <button class="refresh-btn" id="refreshBtn" onclick="loadData()">é‡æ–°æ•´ç†</button>
        </div>

        <!-- éŒ¯èª¤è¨Šæ¯ -->
        <div id="errorContainer"></div>

        <!-- ===== é¦–é  ===== -->
        <div id="home" class="page active">
            <!-- æ¨™é¡Œå€ -->
            <div class="header">
                <h1>ä½é™¢é†«å¸«åº§è«‡æœƒæˆæ•ˆè¿½è¹¤å„€è¡¨æ¿</h1>
                <p>å¯¦æ™‚ç›£æ§åº§è«‡æœƒææ¡ˆé€²åº¦èˆ‡æˆæ•ˆ</p>
                <div class="meeting-info">
                    <div class="info-item">
                        <span class="info-label">æœƒè­°æ—¥æœŸï¼š</span>
                        <span class="info-value" id="meetingDate">è¼‰å…¥ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ææ¡ˆç¸½æ•¸ï¼š</span>
                        <span class="info-value" id="totalProposals">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å‡ºå¸­äººæ•¸ï¼š</span>
                        <span class="info-value" id="totalAttendance">0</span>
                    </div>
                </div>
            </div>

            <!-- çµ±è¨ˆå¡ç‰‡ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">å¾…æ±ºè­°</div>
                    <div class="stat-value" id="statPending">0</div>
                    <div class="stat-unit">é …ææ¡ˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">é€²è¡Œä¸­</div>
                    <div class="stat-value" id="statProgress">0</div>
                    <div class="stat-unit">é …ææ¡ˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å·²çµæ¡ˆ</div>
                    <div class="stat-value" id="statClosed">0</div>
                    <div class="stat-unit">é …ææ¡ˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å®Œæˆç‡</div>
                    <div class="stat-value" id="statCompletionRate">0%</div>
                    <div class="stat-unit">å·²çµæ¡ˆæ¯”ä¾‹</div>
                </div>
            </div>

            <!-- åœ–è¡¨å€ -->
            <div class="charts-section">
                <div class="chart-card">
                    <div class="chart-title">è­°é¡Œé¡åˆ¥çµ±è¨ˆ</div>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">ææ¡ˆç‹€æ…‹åˆ†ä½ˆ</div>
                    <div class="chart-container">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- è¿½è¹¤é …ç›®åˆ—è¡¨ -->
            <div class="tracking-section">
                <div class="section-title">è¿½è¹¤é …ç›®è©³æƒ…</div>
                <div id="trackingList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>è¼‰å…¥è¿½è¹¤é …ç›®ä¸­...</p>
                    </div>
                </div>
            </div>

            <!-- å‡ºå¸­äººå“¡åˆ—è¡¨ -->
            <div class="attendance-section">
                <div class="section-title">å‡ºå¸­äººå“¡åå–®</div>
                <div id="attendanceList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>è¼‰å…¥å‡ºå¸­äººå“¡ä¸­...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== è©³ç´°åˆ†æé é¢ ===== -->
        <div id="analysis" class="page">
            <!-- åˆ†ææ¨™é¡Œ -->
            <div class="analysis-header">
                <h2>2025/12/24 åº§è«‡æœƒæˆæ•ˆåˆ†æ</h2>
                <div class="analysis-stats">
                    <div class="analysis-stat">
                        <div class="analysis-stat-label">ç¸½ææ¡ˆæ•¸</div>
                        <div class="analysis-stat-value" id="analysisTotalProposals">0</div>
                    </div>
                    <div class="analysis-stat">
                        <div class="analysis-stat-label">å¾…æ±ºè­°</div>
                        <div class="analysis-stat-value" id="analysisPending">0</div>
                    </div>
                    <div class="analysis-stat">
                        <div class="analysis-stat-label">é€²è¡Œä¸­</div>
                        <div class="analysis-stat-value" id="analysisProgress">0</div>
                    </div>
                    <div class="analysis-stat">
                        <div class="analysis-stat-label">å·²çµæ¡ˆ</div>
                        <div class="analysis-stat-value" id="analysisClosed">0</div>
                    </div>
                </div>
            </div>

            <!-- åˆ†æå…§å®¹ -->
            <div class="analysis-content">
                <!-- è­°é¡Œé¡åˆ¥åˆ†æ -->
                <div class="analysis-card">
                    <div class="analysis-card-title">è­°é¡Œé¡åˆ¥åˆ†æ</div>
                    <div id="categoryAnalysis">
                        <div class="loading">
                            <p>è¼‰å…¥ä¸­...</p>
                        </div>
                    </div>
                </div>

                <!-- åœ“é¤…åœ– -->
                <div class="analysis-card">
                    <div class="analysis-card-title">è­°é¡Œé¡åˆ¥åˆ†å¸ƒ</div>
                    <div class="chart-container">
                        <canvas id="analysisCategoryChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- è©³ç´°åˆ†æè¡¨æ ¼ -->
            <div class="tracking-section">
                <div class="section-title">ææ¡ˆè©³ç´°åˆ†æ</div>
                <div id="analysisTrackingList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>è¼‰å…¥åˆ†æè³‡æ–™ä¸­...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ -->
    <div class="footer">
        <p>è³‡æ–™ä¾†æºï¼šGoogle Sheets | æœ€å¾Œæ›´æ–°ï¼š<span id="footerUpdate">è¼‰å…¥ä¸­...</span></p>
    </div>

    <script>
        // é…ç½®
        const CONFIG = {
            API_URL: 'https://script.google.com/macros/s/AKfycbwp8wbNQaU0J9SQX6r1EUdhuAvnfDgsyfSXkIjtOHtGeXgu8hSN5_jKQ9_WqpFbvhkR9g/exec',
            REFRESH_INTERVAL: 5 * 60 * 1000
        };

        // å…¨åŸŸè®Šæ•¸
        let dashboardData = null;
        let categoryChart = null;
        let statusChart = null;
        let analysisCategoryChart = null;

        // é¡è‰²é…ç½®
        const COLORS = {
            primary: '#4a90e2',
            success: '#27ae60',
            warning: '#f39c12',
            danger: '#e74c3c',
            info: '#3498db',
            light: '#ecf0f1',
            dark: '#2c3e50',
            categories: [
                '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8',
                '#F7DC6F', '#BB8FCE', '#85C1E2', '#F8B88B', '#A9DFBF'
            ]
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            setInterval(loadData, CONFIG.REFRESH_INTERVAL);
        });

        // é é¢åˆ‡æ›
        function switchPage(pageName) {
            // éš±è—æ‰€æœ‰é é¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // æ›´æ–°å°èˆªæŒ‰éˆ•
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // é¡¯ç¤ºé¸å®šçš„é é¢
            document.getElementById(pageName).classList.add('active');

            // æ›´æ–°å°èˆªæŒ‰éˆ•ç‹€æ…‹
            event.target.classList.add('active');

            // å¦‚æœæ˜¯åˆ†æé é¢ï¼Œæ›´æ–°åœ–è¡¨
            if (pageName === 'analysis' && dashboardData) {
                updateAnalysisPage();
            }
        }

        // è¼‰å…¥è³‡æ–™
        async function loadData() {
            try {
                const refreshBtn = document.getElementById('refreshBtn');
                refreshBtn.disabled = true;
                refreshBtn.textContent = 'æ›´æ–°ä¸­...';

                const response = await fetch(CONFIG.API_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                dashboardData = await response.json();

                // æ›´æ–°é¦–é 
                updateHeader();
                updateStats();
                updateCharts();
                updateTrackingList();
                updateAttendanceList();
                updateTimestamp();

                // å¦‚æœåœ¨åˆ†æé é¢ï¼Œä¹Ÿæ›´æ–°åˆ†æé é¢
                if (document.getElementById('analysis').classList.contains('active')) {
                    updateAnalysisPage();
                }

                document.getElementById('errorContainer').innerHTML = '';
                refreshBtn.disabled = false;
                refreshBtn.textContent = 'é‡æ–°æ•´ç†';
            } catch (error) {
                console.error('Error loading data:', error);
                showError(`ç„¡æ³•è¼‰å…¥è³‡æ–™ï¼š${error.message}`);
                document.getElementById('refreshBtn').disabled = false;
                document.getElementById('refreshBtn').textContent = 'é‡æ–°æ•´ç†';
            }
        }

        // æ›´æ–°æ¨™é¡Œå€
        function updateHeader() {
            if (!dashboardData || !dashboardData.tracking || dashboardData.tracking.length === 0) {
                return;
            }

            const firstTracking = dashboardData.tracking[0];
            const meetingDate = new Date(firstTracking.meeting_date);
            document.getElementById('meetingDate').textContent = meetingDate.toLocaleDateString('zh-TW');
            document.getElementById('totalProposals').textContent = dashboardData.tracking.length;
            document.getElementById('totalAttendance').textContent = dashboardData.attendance.length;
        }

        // æ›´æ–°çµ±è¨ˆå¡ç‰‡
        function updateStats() {
            if (!dashboardData || !dashboardData.tracking) return;

            const tracking = dashboardData.tracking;
            const pending = tracking.filter(t => t.status === 'å¾…æ±ºè­°').length;
            const progress = tracking.filter(t => t.status === 'é€²è¡Œä¸­').length;
            const closed = tracking.filter(t => t.status === 'å·²çµæ¡ˆ').length;
            const completionRate = Math.round((closed / tracking.length) * 100);

            document.getElementById('statPending').textContent = pending;
            document.getElementById('statProgress').textContent = progress;
            document.getElementById('statClosed').textContent = closed;
            document.getElementById('statCompletionRate').textContent = completionRate + '%';
        }

        // æ›´æ–°åœ–è¡¨
        function updateCharts() {
            if (!dashboardData || !dashboardData.tracking) return;

            updateCategoryChart();
            updateStatusChart();
        }

        // æ›´æ–°è­°é¡Œé¡åˆ¥åœ“é¤…åœ–
        function updateCategoryChart() {
            const tracking = dashboardData.tracking;
            const categoryMap = {};

            tracking.forEach(item => {
                const category = item.category || 'æœªåˆ†é¡';
                categoryMap[category] = (categoryMap[category] || 0) + 1;
            });

            const labels = Object.keys(categoryMap);
            const data = Object.values(categoryMap);

            const ctx = document.getElementById('categoryChart').getContext('2d');

            if (categoryChart) {
                categoryChart.destroy();
            }

            categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: COLORS.categories.slice(0, labels.length),
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { size: 12 },
                                padding: 15
                            }
                        }
                    }
                }
            });
        }

        // æ›´æ–°ç‹€æ…‹åˆ†ä½ˆåœ–
        function updateStatusChart() {
            const tracking = dashboardData.tracking;
            const statusMap = {
                'å¾…æ±ºè­°': 0,
                'é€²è¡Œä¸­': 0,
                'å·²çµæ¡ˆ': 0
            };

            tracking.forEach(item => {
                if (statusMap.hasOwnProperty(item.status)) {
                    statusMap[item.status]++;
                }
            });

            const ctx = document.getElementById('statusChart').getContext('2d');

            if (statusChart) {
                statusChart.destroy();
            }

            statusChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['å¾…æ±ºè­°', 'é€²è¡Œä¸­', 'å·²çµæ¡ˆ'],
                    datasets: [{
                        label: 'ææ¡ˆæ•¸é‡',
                        data: [statusMap['å¾…æ±ºè­°'], statusMap['é€²è¡Œä¸­'], statusMap['å·²çµæ¡ˆ']],
                        backgroundColor: [COLORS.warning, COLORS.info, COLORS.success],
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // æ›´æ–°è¿½è¹¤é …ç›®åˆ—è¡¨
        function updateTrackingList() {
            if (!dashboardData || !dashboardData.tracking) return;

            const trackingList = document.getElementById('trackingList');
            trackingList.innerHTML = '';

            dashboardData.tracking.forEach((item, index) => {
                const statusClass = `status-${getStatusClass(item.status)}`;
                const html = `
                    <div class="tracking-item">
                        <div class="tracking-header">
                            <span class="tracking-sequence">åºè™Ÿ ${item.sequence}</span>
                            <span class="tracking-category">${item.category}</span>
                            <span class="tracking-status ${statusClass}">${item.status}</span>
                        </div>
                        <div class="tracking-target">${item.target}</div>
                        <div class="tracking-details">
                            <div class="detail-item">
                                <div class="detail-label">ææ¡ˆè€…</div>
                                <div class="detail-value">${item.proposer}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">è² è²¬çª—å£</div>
                                <div class="detail-value">${item.pic}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">é è¨ˆé‡Œç¨‹ç¢‘</div>
                                <div class="detail-value">${item.milestone}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æœƒè­°æ±ºè­°</div>
                                <div class="detail-value">${item.resolution}</div>
                            </div>
                            ${item.tracking_report ? `
                            <div class="detail-item">
                                <div class="detail-label">è¿½è¹¤å ±å‘Š</div>
                                <div class="detail-value">${item.tracking_report}</div>
                            </div>
                            ` : ''}
                            ${item.tracking_date ? `
                            <div class="detail-item">
                                <div class="detail-label">è¿½è¹¤æ—¥æœŸ</div>
                                <div class="detail-value">${item.tracking_date}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                trackingList.innerHTML += html;
            });
        }

        // æ›´æ–°å‡ºå¸­äººå“¡åˆ—è¡¨
        function updateAttendanceList() {
            if (!dashboardData || !dashboardData.attendance) return;

            const attendanceList = document.getElementById('attendanceList');
            attendanceList.innerHTML = '';

            dashboardData.attendance.forEach((person, index) => {
                const html = `
                    <div class="attendance-card">
                        <div class="attendance-name">${person.name}</div>
                        <div class="attendance-info">
                            <div><strong>ç§‘åˆ¥ï¼š</strong> ${person.department_name}</div>
                            <div><strong>è·ç¨±ï¼š</strong> ${person.position}</div>
                            <div><strong>äººäº‹è™Ÿï¼š</strong> ${person.person_id}</div>
                            <div><strong>åœ°é»ï¼š</strong> ${person.location}</div>
                            <div class="attendance-role">${person.role}</div>
                        </div>
                    </div>
                `;
                attendanceList.innerHTML += html;
            });
        }

        // æ›´æ–°åˆ†æé é¢
        function updateAnalysisPage() {
            if (!dashboardData || !dashboardData.tracking) return;

            const tracking = dashboardData.tracking;
            const pending = tracking.filter(t => t.status === 'å¾…æ±ºè­°').length;
            const progress = tracking.filter(t => t.status === 'é€²è¡Œä¸­').length;
            const closed = tracking.filter(t => t.status === 'å·²çµæ¡ˆ').length;

            // æ›´æ–°çµ±è¨ˆ
            document.getElementById('analysisTotalProposals').textContent = tracking.length;
            document.getElementById('analysisPending').textContent = pending;
            document.getElementById('analysisProgress').textContent = progress;
            document.getElementById('analysisClosed').textContent = closed;

            // æ›´æ–°è­°é¡Œé¡åˆ¥åˆ†æ
            updateCategoryAnalysis();

            // æ›´æ–°åˆ†æåœ“é¤…åœ–
            updateAnalysisCategoryChart();

            // æ›´æ–°è¿½è¹¤é …ç›®åˆ—è¡¨
            updateAnalysisTrackingList();
        }

        // æ›´æ–°è­°é¡Œé¡åˆ¥åˆ†æ
        function updateCategoryAnalysis() {
            const tracking = dashboardData.tracking;
            const categoryMap = {};

            tracking.forEach(item => {
                const category = item.category || 'æœªåˆ†é¡';
                categoryMap[category] = (categoryMap[category] || 0) + 1;
            });

            const categoryAnalysis = document.getElementById('categoryAnalysis');
            categoryAnalysis.innerHTML = '';

            const totalItems = tracking.length;

            Object.entries(categoryMap).forEach(([category, count]) => {
                const percentage = Math.round((count / totalItems) * 100);
                const html = `
                    <div class="category-item">
                        <div class="category-name">${category}</div>
                        <div class="category-count">${count} é …</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%"></div>
                    </div>
                `;
                categoryAnalysis.innerHTML += html;
            });
        }

        // æ›´æ–°åˆ†æåœ“é¤…åœ–
        function updateAnalysisCategoryChart() {
            const tracking = dashboardData.tracking;
            const categoryMap = {};

            tracking.forEach(item => {
                const category = item.category || 'æœªåˆ†é¡';
                categoryMap[category] = (categoryMap[category] || 0) + 1;
            });

            const labels = Object.keys(categoryMap);
            const data = Object.values(categoryMap);

            const ctx = document.getElementById('analysisCategoryChart').getContext('2d');

            if (analysisCategoryChart) {
                analysisCategoryChart.destroy();
            }

            analysisCategoryChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: COLORS.categories.slice(0, labels.length),
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { size: 12 },
                                padding: 15
                            }
                        }
                    }
                }
            });
        }

        // æ›´æ–°åˆ†æè¿½è¹¤é …ç›®åˆ—è¡¨
        function updateAnalysisTrackingList() {
            if (!dashboardData || !dashboardData.tracking) return;

            const trackingList = document.getElementById('analysisTrackingList');
            trackingList.innerHTML = '';

            dashboardData.tracking.forEach((item, index) => {
                const statusClass = `status-${getStatusClass(item.status)}`;
                const html = `
                    <div class="tracking-item">
                        <div class="tracking-header">
                            <span class="tracking-sequence">åºè™Ÿ ${item.sequence}</span>
                            <span class="tracking-category">${item.category}</span>
                            <span class="tracking-status ${statusClass}">${item.status}</span>
                        </div>
                        <div class="tracking-target">${item.target}</div>
                        <div class="tracking-details">
                            <div class="detail-item">
                                <div class="detail-label">ææ¡ˆè€…</div>
                                <div class="detail-value">${item.proposer}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">è² è²¬çª—å£</div>
                                <div class="detail-value">${item.pic}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">é è¨ˆé‡Œç¨‹ç¢‘</div>
                                <div class="detail-value">${item.milestone}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æœƒè­°æ±ºè­°</div>
                                <div class="detail-value">${item.resolution}</div>
                            </div>
                            ${item.tracking_report ? `
                            <div class="detail-item">
                                <div class="detail-label">è¿½è¹¤å ±å‘Š</div>
                                <div class="detail-value">${item.tracking_report}</div>
                            </div>
                            ` : ''}
                            ${item.tracking_date ? `
                            <div class="detail-item">
                                <div class="detail-label">è¿½è¹¤æ—¥æœŸ</div>
                                <div class="detail-value">${item.tracking_date}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                trackingList.innerHTML += html;
            });
        }

        // æ›´æ–°æ™‚é–“æˆ³
        function updateTimestamp() {
            if (!dashboardData) return;

            const lastUpdated = new Date(dashboardData.lastUpdated);
            const formattedTime = lastUpdated.toLocaleString('zh-TW');

            document.getElementById('lastUpdate').textContent = formattedTime;
            document.getElementById('footerUpdate').textContent = formattedTime;
        }

        // è¼”åŠ©å‡½æ•¸
        function getStatusClass(status) {
            switch (status) {
                case 'å¾…æ±ºè­°':
                    return 'pending';
                case 'é€²è¡Œä¸­':
                    return 'progress';
                case 'å·²çµæ¡ˆ':
                    return 'closed';
                default:
                    return 'pending';
            }
        }

        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `<div class="error">${message}</div>`;
        }
    </script>
</body>
</html>
